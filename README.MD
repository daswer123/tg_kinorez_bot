# Техническое задание: Telegram-бот для обработки и обрезки видео

## Общее описание
Разработка Telegram-бота на базе aiogram 3 для автоматической обработки и обрезки видео с YouTube по запросу пользователя. Бот должен принимать ссылки на видео с указанием временных меток, обрабатывать их и отправлять обрезанные видео пользователю.

## Технический стек
- Python 3.x
- aiogram 3.x
- yt_dlp для загрузки и обработки видео
- Instructor для структурированного вывода данных от LLM
- OpenRouter API для обработки пользовательского ввода

## Принцип работы
1. Пользователь отправляет боту ссылку на YouTube-видео с указанием временных меток в свободном формате.
2. Бот использует OpenRouter API и библиотеку Instructor для структурированного парсинга запроса.
3. Извлекается URL видео и временные метки начала и конца фрагмента.
4. Система проверяет корректность временных меток и сообщает пользователю о возможных ошибках.
5. С помощью yt_dlp происходит загрузка и обрезка видео.
6. Обработанное видео отправляется пользователю в чат.

## Обработка пользовательского ввода
Бот должен корректно обрабатывать запросы в свободной форме, например:
- "https://www.youtube.com/watch?v=Rjl07pIFiz4 с 10 секунды до минуты"
- "Вырежи с начала и до 40 секунды https://www.youtube.com/watch?v=Rjl07pIFiz4"
- "https://www.youtube.com/watch?v=Rjl07pIFiz4 00:10 - 00:40"

В случае некорректных временных меток или других ошибок, бот должен указать пользователю, что именно было неправильно понято, и запросить уточнение.

## Важные ресурсы для изучения
- Статья о Structure Output у моделей: [https://habr.com/ru/articles/831398/](https://habr.com/ru/articles/831398/)
- Документация библиотеки Instructor: [https://github.com/instructor-ai/instructor](https://github.com/instructor-ai/instructor)

## Особенности реализации
При использовании Instructor необходимо настроить следующим образом:
```python
client = instructor.from_openai(OpenAI(base_url=BASE_URL, api_key=API_KEY), mode=instructor.Mode.JSON)
```

Для обработки ввода используем модель через OpenRouter, в качестве базового URL указываем OpenRouter, а в API-ключ — ваш ключ доступа.

## Потенциальные проблемы и решения
1. **Ограничения Telegram на размер файлов**:
   - Telegram ограничивает отправку видео до 20 МБ и документов до 50 МБ.
   - Возможные решения:
     а) Загрузка файлов в сторонний сервис и предоставление ссылки на скачивание.
     б) Использование Telegram API сервера (требуется решить вопрос с Docker и HTTP-трафиком).
     б) Уже реализованно другим разработчиком нужно подумать как применить https://github.com/Olegt0rr/telegram-local

2. **Доступ к YouTube**:
   - Может потребоваться настройка прокси для стабильной работы с YouTube.
   - Необходимо изучить вопрос интеграции прокси с yt_dlp.

## Дальнейшие шаги
После завершения разработки необходимо упаковать решение в Docker-контейнер для удобного развертывания. Это может быть выполнено разработчиком (будет плюсом).

Ориентируйтесь на примеры кода из папки `test_code` для понимания принципа работы.